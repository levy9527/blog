(window.webpackJsonp=window.webpackJsonp||[]).push([[28],{303:function(s,t,a){"use strict";a.r(t);var e=a(10),n=Object(e.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"使用-cypress-进行端对端测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-cypress-进行端对端测试"}},[s._v("#")]),s._v(" 使用 Cypress 进行端对端测试")]),s._v(" "),t("h2",{attrs:{id:"为什么写端对端测试"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么写端对端测试"}},[s._v("#")]),s._v(" 为什么写端对端测试")]),s._v(" "),t("p",[s._v("写端对端测试代码的最大好处就是，把相关的用例变成可执行的代码，成为项目的资产；结合CI系统，可在后续研发维护过程中，将一部分测试过程自动化，减少重复的手工劳动，既保障质量，又提高效率。")]),s._v(" "),t("p",[s._v("谁来写呢？本文的目标读者是前端研发人员，因而相关测试代码是由前端同学去编写的。")]),s._v(" "),t("h2",{attrs:{id:"为什么用-cypress"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#为什么用-cypress"}},[s._v("#")]),s._v(" 为什么用 Cypress")]),s._v(" "),t("p",[s._v("文档齐全，生态好，对 JavaScript 友好，可简单上手。更多详见："),t("a",{attrs:{href:"https://docs.cypress.io/guides/overview/why-cypress.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("why-cypress"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("缺点：全英文档")]),s._v(" "),t("h2",{attrs:{id:"快速开始"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#快速开始"}},[s._v("#")]),s._v(" 快速开始")]),s._v(" "),t("h3",{attrs:{id:"安装"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" cypress "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v("\n")])])]),t("p",[s._v("下载完依赖后，cypress 还会再从网络下载二进制执行包。安装完成后会在本地全局缓存一份二进制执行包，那么这台机器上所有项目都可以使用这份缓存。"),t("a",{attrs:{href:"https://docs.cypress.io/guides/getting-started/installing-cypress.html#npm-install",target:"_blank",rel:"noopener noreferrer"}},[s._v("文档参考"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("一般而言，国内用户都会在上述过程中卡住，最好在命令行设置网络代理后再下载（懂的自然懂）。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("https_proxy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://127.0.0.1:7890 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("http_proxy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://127.0.0.1:7890 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("all_proxy")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("socks5://127.0.0.1:7890\n")])])]),t("p",[s._v("如果是在 CI 环境，记得缓存 cypress binary。")]),s._v(" "),t("p",[s._v("安装完后，修改 package.json")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"e2e"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cypress open"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"加速下载"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#加速下载"}},[s._v("#")]),s._v(" 加速下载")]),s._v(" "),t("p",[s._v("因为安装时，需要科学上网，如果不想设置代理，也能加速下载安装。可以自己先下载官方提供的二进制 "),t("a",{attrs:{href:"https://download.cypress.io/desktop.json",target:"_blank",rel:"noopener noreferrer"}},[s._v("cypress.zip"),t("OutboundLink")],1),s._v("，再上传至自己的 OSS。")]),s._v(" "),t("p",[s._v("则安装 Cypress 时，设置 "),t("code",[s._v("CYPRESS_INSTALL_BINARY")]),s._v(" 指向对应的地址即可。如")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("CYPRESS_INSTALL_BINARY=https"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//your-oss.com/6.1.0-linux-x64-cypress.zip yarn")]),s._v("\n")])])]),t("p",[s._v("或使用淘宝镜像，缺点是可能包不是最新的。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CYPRESS_INSTALL_BINARY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://npm.taobao.org/mirrors/cypress/6.2.0/linux/cypress.zip\n")])])]),t("p",[s._v("或这样写")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CYPRESS_DOWNLOAD_MIRROR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://npm.taobao.org "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v("  cypress "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-D")]),s._v("\n")])])]),t("h3",{attrs:{id:"目录结构"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#目录结构"}},[s._v("#")]),s._v(" 目录结构")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/software-testing/1686494179328.png",alt:"image.png"}}),s._v("\n推荐结构如上图所示的目录结构：")]),s._v(" "),t("ul",[t("li",[s._v("cypress 相关的内容放到 test/e2e 文件夹下。与单元测试的 unit 文件夹区分开来")]),s._v(" "),t("li",[s._v("config 存放不同环境下的"),t("a",{attrs:{href:"https://docs.cypress.io/guides/guides/environment-variables.html#Setting",target:"_blank",rel:"noopener noreferrer"}},[s._v("变量"),t("OutboundLink")],1),s._v("，如 dev/uat 环境的 baseUrl 是不同的，可分别在 config 里")]),s._v(" "),t("li",[s._v("fixtures 存放测试 mock 数据")]),s._v(" "),t("li",[s._v("integration 存放的就是 cypress 的测试用例了，命名规范同 jest：${name}.spec.js")]),s._v(" "),t("li",[s._v("plugins 存放的是相关插件")]),s._v(" "),t("li",[s._v("support 存放自定义的 cypress 命令")])]),s._v(" "),t("p",[s._v("可以根据要求，修改文件夹目录结构，只要在 cypress.json 里配置好即可：")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"fixturesFolder"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test/e2e/fixtures"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"integrationFolder"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test/e2e/integration"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"pluginsFile"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test/e2e/plugins/index.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"screenshotsFolder"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test/e2e/screenshots"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"supportFile"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test/e2e/support/index.js"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"videosFolder"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"test/e2e/videos"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"viewportWidth"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1280")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"viewportHeight"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("800")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("blockquote",[t("p",[s._v("注意，如果不显示声明这些配置，每次执行 cypress 命令都会自动生成相应的示例文件")])]),s._v(" "),t("p",[s._v("cypress.json 是放在项目根目录下的默认配置文件，全部配置项可"),t("a",{attrs:{href:"https://docs.cypress.io/guides/references/configuration.html#Options",target:"_blank",rel:"noopener noreferrer"}},[s._v("查看文档"),t("OutboundLink")],1)]),s._v(" "),t("blockquote",[t("p",[s._v("通过 "),t("a",{attrs:{href:"https://github.com/FEMessage/create-nuxt-app",target:"_blank",rel:"noopener noreferrer"}},[s._v("FEMessage/create-nuxt-app"),t("OutboundLink")],1),s._v(" 生成的项目默认是使用上面的配置")])]),s._v(" "),t("h3",{attrs:{id:"与-jest-协同工作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#与-jest-协同工作"}},[s._v("#")]),s._v(" 与 Jest 协同工作")]),s._v(" "),t("p",[s._v("当项目也在使用 jest 进行单元测试时，有两个注意点。")]),s._v(" "),t("h4",{attrs:{id:"eslint-配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#eslint-配置"}},[s._v("#")]),s._v(" ESLint 配置")]),s._v(" "),t("p",[s._v("推荐项目中存在三份 eslint 配置文件：")]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 项目根目录下的 .eslintrc.js")]),s._v("\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("root")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'plugin:prettier/recommended'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// test/unit/.eslintrc.js")]),s._v("\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'plugin:jest/recommended'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// test/e2e/.eslintrc.js")]),s._v("\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("extends")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'plugin:cypress/recommended'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("当然，还要安装相应的依赖：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" eslint-plugin-jest eslint-plugin-cypress "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--dev")]),s._v("\n")])])]),t("h4",{attrs:{id:"测试目录"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#测试目录"}},[s._v("#")]),s._v(" 测试目录")]),s._v(" "),t("p",[s._v("两个工具都需要明确指定各自的测试目录。")]),s._v(" "),t("p",[s._v("cypress 的测试目录可通过上文所说的  cypress.json 指定。")]),s._v(" "),t("p",[s._v("jest 测试目录则可通过在 jest.config.js 里指定：")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("module.exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  // 也可使用 testRegex 属性\n  // 详见文档：https://jestjs.io/docs/en/configuration"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#testmatch-arraystring")]),s._v("\n  testMatch: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'<rootDir>/test/unit/?(*.)+(spec|test).[jt]s?(x)'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("h3",{attrs:{id:"检查依赖及生产安装依赖命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#检查依赖及生产安装依赖命令"}},[s._v("#")]),s._v(" 检查依赖及生产安装依赖命令")]),s._v(" "),t("p",[s._v("请确保生产安装依赖命令为")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("yarn --frozen-lockfile --production\n")])])]),t("p",[s._v("上述命令，只会安装 package.json 里声明的 "),t("code",[s._v("dependencies")]),s._v(" 依赖，避免因为下载 Cypress 而超时。")]),s._v(" "),t("p",[s._v("因此，也要确保项目中 package.json 中的 "),t("code",[s._v("dependencies")]),s._v(" "),t("code",[s._v("devDependencies")]),s._v(" 等声明是正确的。")]),s._v(" "),t("h3",{attrs:{id:"第一个用例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第一个用例"}},[s._v("#")]),s._v(" 第一个用例")]),s._v(" "),t("p",[s._v("新建 common.spec.js")]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("describe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("''")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("it")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'联系客服按钮'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    cy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("visit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    cy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.cy-customer-service'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("click")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    cy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'[id*=_QIDIAN_WEB_IM_IFRAME_]'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("should")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'exist'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n  "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("it")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'合作生态 加入我们 按钮'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    cy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("visit")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/cooperation/si'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    cy"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'.cy-cooperation-btn'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("should")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'have.css'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'width'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'98px'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("p",[s._v("上面的示例覆盖了三个 cypress 常用命令：")]),s._v(" "),t("ul",[t("li",[s._v("跳转页面")]),s._v(" "),t("li",[s._v("获取元素")]),s._v(" "),t("li",[s._v("断言")])]),s._v(" "),t("p",[s._v("这里说一下 "),t("code",[s._v("should")]),s._v(" 命令，它相当于是 "),t("code",[s._v("expect.to")]),s._v(" 的简写。\n如： "),t("code",[s._v("expect($input).to.be.disabled")]),s._v(" 可写成 "),t("code",[s._v("get($input).should('be.disabled')")])]),s._v(" "),t("p",[s._v("更多命令，可"),t("a",{attrs:{href:"https://docs.cypress.io/api/commands/get.html#Syntax",target:"_blank",rel:"noopener noreferrer"}},[s._v("查看API"),t("OutboundLink")],1),s._v("\n常见断言，可"),t("a",{attrs:{href:"https://docs.cypress.io/guides/references/assertions.html#Common-Assertions",target:"_blank",rel:"noopener noreferrer"}},[s._v("查看文档"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("如果想获得代码提示、代码补全，需在开头添加如下语句，（Webstorm不需要此配置）"),t("a",{attrs:{href:"https://docs.cypress.io/zh-cn/guides/tooling/intelligent-code-completion.html#",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考文档"),t("OutboundLink")],1)]),s._v(" "),t("div",{staticClass:"language-javascript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-javascript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('/// <reference types="Cypress" />')]),s._v("\n")])])]),t("hr"),s._v(" "),t("p",[s._v("执行 "),t("code",[s._v("yarn e2e")]),s._v(" ，出现弹窗\n"),t("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/software-testing/1686494184473.png",alt:"image.png"}}),s._v("\n点击文件，即会执行用例。\n"),t("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/software-testing/1686494186469.png",alt:"image.png"}})]),s._v(" "),t("h3",{attrs:{id:"更复杂的示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#更复杂的示例"}},[s._v("#")]),s._v(" 更复杂的示例")]),s._v(" "),t("div",{staticClass:"language- extra-class"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("  beforeEach(() => {\n    // 免登录\n    cy.setCookie('_yapi_token', 'GXgIZ7rr7gF1o38EugAWgSgHoyC-e2MbZU43uHapqkk')\n    cy.setCookie('_yapi_uid', '2426')\n  })\n  \n  it('import swagger', () => {\n    let resp = {\"code\":\"1\",\"payload\":{\"total\":-1,\"rows\":[]},\"success\":true}\n\n    let apps = resp.payload.rows.filter(item => item.language == 'Java8' && ['job', 'scheduler', 'openresty'].every(name => !item.name.includes(name)))\n    \n    apps.forEach(item => {\n      let url = `https://dev-dbi.deepexi.com/${item.name}/v2/api-docs`;\n\n      let dapi = 'https://dapi.deepexi.com/group/2120'\n      cy.visit(dapi)\n      cy.wait(1000)\n\n      // cy.contains(item.name).click()\n      cy.contains('添加项目').click()\n      cy.get('#name').type(item.name)\n      cy.contains('创建项目').click()\n\n      cy.contains('设 置').click()\n      cy.contains('Swagger自动同步').click()\n      cy.get('.ant-switch-inner').last().click()\n      cy.get('.ant-select-selection').last().click()\n      cy.contains('智能合并').click() // 选择下拉列表选项\n      cy.get('#sync_json_url').type(url)\n      cy.contains('保存').click()\n      cy.wait(1000)\n    })\n  })\n")])])]),t("h2",{attrs:{id:"结合typescript"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#结合typescript"}},[s._v("#")]),s._v(" 结合TypeScript")]),s._v(" "),t("p",[s._v("在 e2e 目录添加 tsconfig.json，内容如下：")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"compilerOptions"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"noEmit"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// be explicit about types included to avoid clashing with Jest types")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// add more types if have custom commands")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"types"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cypress"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" \n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"include"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"../../node_modules/cypress"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"./*/*.ts"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("在 e2e/support 添加 index.d.ts，如果有自定义命令的话")]),s._v(" "),t("div",{staticClass:"language-typescript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-typescript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* eslint-disable no-unused-vars */")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('/// <reference types="cypress" />')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("declare")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("namespace")]),s._v(" Cypress "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// eslint-disable-next-line @typescript-eslint/no-unused-vars")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Chainable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Subject"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * Create login server\n     * @example\n     * cy.login()\n     */")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("login")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" Chainable"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("any")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])])]),t("p",[s._v("将 e2e/integration/xxx.spec.js 重命名为  e2e/integration/xxx.spec.ts，并添加如下2行内容：")]),s._v(" "),t("div",{staticClass:"language-typescript extra-class"},[t("pre",{pre:!0,attrs:{class:"language-typescript"}},[t("code",[t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('/// <reference types="cypress"/>')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('/// <reference types="../../support" />')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("descript")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'something'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("function")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// some test code here")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])])]),t("h2",{attrs:{id:"持续集成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#持续集成"}},[s._v("#")]),s._v(" 持续集成")]),s._v(" "),t("p",[s._v("持续集成的第一步要选择合适的包含 Cypress 的"),t("a",{attrs:{href:"https://github.com/cypress-io/cypress-docker-images",target:"_blank",rel:"noopener noreferrer"}},[s._v("镜像"),t("OutboundLink")],1),s._v("。")]),s._v(" "),t("blockquote",[t("p",[s._v("注意自身的 Node 版本选择合适的镜像。")])]),s._v(" "),t("p",[s._v("另一方面，一般 CI 环境下执行的是 "),t("code",[s._v("cypress run")]),s._v(" 命令。")]),s._v(" "),t("blockquote",[t("p",[s._v("run 与 open 的不同之处在于，run 默认不会启动浏览器界面，使用的是 headless 模式执行用例。")])]),s._v(" "),t("p",[s._v("同时，需要安装 Cypress 时，需要设置环境变量 "),t("code",[s._v("CYPRESS_INSTALL_BINARY")])]),s._v(" "),t("p",[s._v("最后，还是要强调一下，在生产安装依赖环节，使用如下命令安装依赖，则不会安装 Cypress 依赖")]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[s._v("yarn --frozen-lockfile --production\n")])])]),t("h3",{attrs:{id:"直接运行-cypress"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#直接运行-cypress"}},[s._v("#")]),s._v(" 直接运行 Cypress")]),s._v(" "),t("p",[s._v("直接运行 Cypress 的场景是，e2e 作为 CI 的最后一个"),t("a",{attrs:{href:"https://docs.gitlab.com/ee/ci/yaml/README.html#stages",target:"_blank",rel:"noopener noreferrer"}},[s._v("阶段"),t("OutboundLink")],1),s._v("，当应用完成部署后，再对应用运行线上的测试。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("cypress:\n  image:\n    name: cypress/base:12.19.0\n    entrypoint: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://github.com/cypress-io/cypress-docker-images/issues/300")]),s._v("\n  stage: e2e\n  when: manual\n  tags:\n    - "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n  script:\n    - "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CYPRESS_INSTALL_BINARY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("your-domain/cypress.zip "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" --frozen-lockfile\n    - "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" bin"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("/cypress run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--env")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("config")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dev\n")])])]),t("p",[s._v("不推荐选择 "),t("code",[s._v("cypress/included")]),s._v(" 镜像直接执行 Cypress 命令，因为很可能会遇到以下问题。\n当然，如果自己的用例写的不好，也很可能会出现下面的问题。\n"),t("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/software-testing/1686494188361.png",alt:"image.png"}})]),s._v(" "),t("h3",{attrs:{id:"使用-start-server-and-test"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-start-server-and-test"}},[s._v("#")]),s._v(" 使用 start-server-and-test")]),s._v(" "),t("p",[s._v("如果需要本地起个 localhost 服务，然后再运行 cypress。那么可以合作官方推荐的 "),t("code",[s._v("start-server-and-test")]),s._v(" 模块。它在 CI 上的执行顺序是：")]),s._v(" "),t("ol",[t("li",[s._v("在系统后台执行拉起本地服务的命令")]),s._v(" "),t("li",[s._v("使用 wait-on 模块监听并等待该本地服务响应 200")]),s._v(" "),t("li",[s._v("执行 test 命令，完成并退出")]),s._v(" "),t("li",[s._v("CI 环境此时会自动关闭所有后台进程并退出")])]),s._v(" "),t("p",[s._v("下面以 "),t("a",{attrs:{href:"http://gitlab.com/",target:"_blank",rel:"noopener noreferrer"}},[s._v("gitlab.com"),t("OutboundLink")],1),s._v(" 为例，展示执行完 gitlab jobs 后可看到 test 记录和下载测试产物（视频及截图）")]),s._v(" "),t("ul",[t("li",[s._v("package.json")])]),s._v(" "),t("div",{staticClass:"language-json extra-class"},[t("pre",{pre:!0,attrs:{class:"language-json"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"e2e"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"start-server-and-test \\"yarn dev\\" http-get://localhost:3000 \\"cypress run \\""')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"devDependencies"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"cypress"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^6.0.1"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token property"}},[s._v('"start-server-and-test"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"^1.10.8"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])])]),t("ul",[t("li",[s._v(".gitlab-ci.yml")])]),s._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 参考 https://gitlab.com/cypress-io/cypress-example-docker-gitlab/-/blob/master/.gitlab-ci.yml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 参考 https://github.com/cypress-io/cypress-example-kitchensink/blob/master/.gitlab-ci.yml")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这是 gitlab-ci 默认执行顺序。也可以省略")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stages")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" build\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" test\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# to cache both npm modules and Cypress binary we use environment variables")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# to point at the folders we can list as paths in "cache" job settings')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("variables")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("YARN_CACHE_FOLDER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$CI_PROJECT_DIR/.yarn"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("npm_config_cache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$CI_PROJECT_DIR/.npm"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("CYPRESS_CACHE_FOLDER")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$CI_PROJECT_DIR/cache/Cypress"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cache using branch name")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# https://gitlab.com/help/ci/caching/index.md")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cache")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("CI_COMMIT_REF_SLUG"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" .npm\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" .yarn\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cache/Cypress\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" node_modules\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# this job installs NPM dependencies and Cypress")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("install")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" merge_requests\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cypress/base"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("12.19.0\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" yarn "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("frozen"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("lockfile\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# check Cypress binary path and cached versions")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# useful to make sure we are not carrying around old versions")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" $(npm bin)/cypress cache path\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" $(npm bin)/cypress cache list\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" $(npm bin)/cypress verify\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# all jobs that actually run tests can use the same definition")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("e2e test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("only")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" merge_requests\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" cypress/base"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("12.19.0\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("stage")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" test\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("script")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# start the server in the background")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" yarn e2e\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("artifacts")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("when")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" always\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("paths")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cypress/videos/\n      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" cypress/screenshots/\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("expire_in")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 1 week\n")])])]),t("h3",{attrs:{id:"this-job-is-stuck"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#this-job-is-stuck"}},[s._v("#")]),s._v(" This job is stuck")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/software-testing/1686494190870.png",alt:"image.png"}}),s._v("如果是自建的 gitlab, 可能会遇到这个问题。\n这是任务没有打对标签，导致无法给任务分配对应的 Runner。\n"),t("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/software-testing/1686494192801.png",alt:"image.png"}}),s._v("\n进入上图所示页面，注意找到可使用的 Runner\n"),t("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/software-testing/1686494195056.png",alt:"image.png"}}),s._v("\n如上图所示， "),t("code",[s._v("docker")]),s._v(" 标签对应的 Runner 是处于激活状态的，则在 CI 文件里配置即可")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("cypress:\n  tags:\n    - "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\n")])])]),t("h3",{attrs:{id:"cypress-dashbord"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cypress-dashbord"}},[s._v("#")]),s._v(" Cypress Dashbord")]),s._v(" "),t("p",[s._v("Cypress 官方提供了一个测试记录托管服务。在 CI 命令中，只需要加上 "),t("code",[s._v("--record --key $key")]),s._v(" 即可。")]),s._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("script:\n  - cypress run "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--record")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--key")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$key")]),s._v("\n")])])]),t("p",[s._v("CI 日志如下：\n"),t("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/software-testing/1686494197613.png",alt:"image.png"}}),s._v("\n更多介绍请查阅"),t("a",{attrs:{href:"https://docs.cypress.io/guides/dashboard/introduction.html#Features",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),t("OutboundLink")],1)]),s._v(" "),t("h2",{attrs:{id:"总结"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[s._v("#")]),s._v(" 总结")]),s._v(" "),t("p",[s._v("cypress 比较适合写一个流程测试。一般情况下，只需要把整个正常流程操作使用 cypress 记录下来即可。")]),s._v(" "),t("p",[s._v("一个流程可能长这样：创建->验证->修改->验证->删除->验证。那我们就可以根据该流程，模拟填写合法数据，模拟点击提交按钮，检查页面是否有相应内容即可。")]),s._v(" "),t("p",[s._v("这样，每次开发新功能后，编写测试用例，再跑 Cypress，就能把一部分的回归测试自动化了，保证完成新功能的同时，原有功能最低限度地保持可用。")]),s._v(" "),t("h2",{attrs:{id:"拓展阅读"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#拓展阅读"}},[s._v("#")]),s._v(" 拓展阅读")]),s._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://www.yuque.com/femessage/fwrngg/arlhoq",target:"_blank",rel:"noopener noreferrer"}},[s._v("Cypress 实战总结"),t("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=n.exports}}]);
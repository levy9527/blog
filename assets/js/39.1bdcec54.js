(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{314:function(t,a,s){"use strict";s.r(a);var r=s(10),e=Object(r.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"操作-gitlab-mr-的命令行工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#操作-gitlab-mr-的命令行工具"}},[t._v("#")]),t._v(" 操作 Gitlab MR 的命令行工具")]),t._v(" "),a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),a("p",[t._v("为什么开发这个工具？主要解决以下问题：")]),t._v(" "),a("ol",[a("li",[t._v("提测、上 UAT 时，避免漏合代码。")]),t._v(" "),a("li",[t._v("代码冲突时，团队成员不用再问“解决这个冲突要怎么切分支？”")]),t._v(" "),a("li",[t._v("一个 feature 分支要向多个保护分支提交合并请求时，减少烦琐而易错的选取分支的界面操作。")])]),t._v(" "),a("p",[t._v("可能会有人问：为什么会漏合代码？当你在某一个迭代需要来回在不同的 feature 分支切换、一个 feature 横跨多个项目，同时你偶尔还要兼顾 bug 修复的时候，你极容易丢失上下文。并且，不同的 feature 协作一致，可能出现的一种情况是：明明是 feature A 只是合并到 test 分支，却记成了已经合并到 uat 分支了。\n对此，有人问你代码到底合并了没，你怎么确认？一个个项目去相应的主干分支里查看提交历史吗？就是因为不想再这样做了，这个工具便应运而生。")]),t._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("h3",{attrs:{id:"解压zip"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解压zip"}},[t._v("#")]),t._v(" 解压zip")]),t._v(" "),a("p",[t._v("下载并解压文件:")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://r0e715v8ejr.feishu.cn/file/IxH4bYAOkowK08xSid1crXcSnRo",target:"_blank",rel:"noopener noreferrer"}},[t._v("Windows"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://r0e715v8ejr.feishu.cn/file/ORa3buA3donF3TxxPVwcHSYnnQb",target:"_blank",rel:"noopener noreferrer"}},[t._v("Linux"),a("OutboundLink")],1)])]),t._v(" "),a("h3",{attrs:{id:"安装git-bash"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装git-bash"}},[t._v("#")]),t._v(" 安装git bash")]),t._v(" "),a("p",[t._v("Windows系统才要安装。\n如果 git bash 版本不足 2.41.0，最好安装最新版本。")]),t._v(" "),a("p",[t._v("安装地址："),a("a",{attrs:{href:"https://gitforwindows.org/",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://gitforwindows.org/"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[t._v("#")]),t._v(" 配置")]),t._v(" "),a("p",[t._v("新增文件")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vi")]),t._v(" ~/.mr-config.json\n")])])]),a("p",[t._v("复制以下内容：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gitlab_url"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"https://your-gitlab.com"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"gitlab_token"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"your-token"')]),t._v(",\n  "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"codebases"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"default"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dev"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"master"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("p",[t._v("对于该配置的解释，详见后文。")]),t._v(" "),a("h3",{attrs:{id:"gitlab-token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gitlab-token"}},[t._v("#")]),t._v(" gitlab_token")]),t._v(" "),a("p",[t._v("先获取 gitlab token，操作如下：")]),t._v(" "),a("ol",[a("li",[t._v("打开Gitlab，右上角点击个人头像")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154008266.png",alt:"0a8ff2ce0d86d685fd2b5283c40871d9.png"}})]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("点击左侧边栏")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154013693.png",alt:"f1151c580d5672d187ca38699e9c2013.png"}})]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("勾选全部权限，并确认生成 token")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154016668.png",alt:"790ed16e056c26d79f35b7ff4c072c8f.png"}})]),t._v(" "),a("h3",{attrs:{id:"codebases"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#codebases"}},[t._v("#")]),t._v(" codebases")]),t._v(" "),a("p",[t._v("适用于多基线的场景。")]),t._v(" "),a("p",[t._v("如产品默认有三个环境，分别对应三条分支 dev、test、master。\n同时，又有定制化需求，专门为某一客户进行源码改动，同样有三个环境，则可能出现的配置如下：")]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"codebases"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"default"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"dev"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"master"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"customize"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"customize-dev"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"customize-test"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"customize-master"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])]),a("h3",{attrs:{id:"环境变量"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#环境变量"}},[t._v("#")]),t._v(" 环境变量")]),t._v(" "),a("p",[t._v("把 mr.exe 所在目录设置到环境变量中：")]),t._v(" "),a("ol",[a("li",[t._v('查找"环境变量"')])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154020270.png",alt:"157a114acdf00def50ae774b4d68e004.png"}})]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v('点击"环境变量"')])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154023459.png",alt:"6a99dd2754b75348523a388d36067bd9.png"}})]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v('找到 Path，点击"编辑"')])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154026703.png",alt:"d1335d05ddefa6aa33006e9f24f3254f.png"}})]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v('点击"新增"，再点击"浏览"，找到最里层的 mr 目录')])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154030135.png",alt:"6df5b86a1f91452414382718983e0e22.png"}}),t._v("\n（上图是示例，具体路径根据自己的情况而定）")]),t._v(" "),a("p",[t._v("重新打开 git bash 即可生效，记得一定要重新打开！")]),t._v(" "),a("p",[t._v("注：如果是 Linux，那很简单，修改 ~/.bashrc")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("export")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("PATH")])]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token environment constant"}},[t._v("$PATH")]),t._v(":mr文件夹所在路径即可\n")])])]),a("h3",{attrs:{id:"idea"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#idea"}},[t._v("#")]),t._v(" IDEA")]),t._v(" "),a("p",[t._v("该步骤选填，适用于 JetBrains 系列产品，想在 IDEA 的终端中也使用 mr.exe 时可配置。")]),t._v(" "),a("p",[t._v("File -> Settings -> Tools -> Terminal：\n"),a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154033353.png",alt:"image.png"}})]),t._v(" "),a("h2",{attrs:{id:"使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用"}},[t._v("#")]),t._v(" 使用")]),t._v(" "),a("p",[t._v("可以不带参数运行，查看支持的命令：mr.exe\n"),a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154109989.png",alt:"image.png"}})]),t._v(" "),a("h3",{attrs:{id:"创建mr"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建mr"}},[t._v("#")]),t._v(" 创建MR")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认以当前分支作为 source_branch")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 根据 codebases 的设置选择 target_branch")]),t._v("\nmr.exe create\n")])])]),a("p",[t._v("提示输入要提交 MR 的源分支，按回车使用当前分支：\n"),a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154113289.png",alt:"image.png"}}),t._v("\n创建成功：\n"),a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154116622.png",alt:"ae115431acc7c0b9275c158fb99e3eaa.png"}})]),t._v(" "),a("p",[t._v("MR 不会重复创建：\n"),a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154120100.png",alt:"ab7d3ea5177726bbab0ccbcd870d0044.png"}})]),t._v(" "),a("p",[t._v("分支没有代码更新时，也不会创建 MR：\n"),a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154123348.png",alt:"147f745360164598c78c3de8808af1d2.png"}})]),t._v(" "),a("h3",{attrs:{id:"查看mr"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看mr"}},[t._v("#")]),t._v(" 查看MR")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("mr.exe list\n")])])]),a("p",[t._v("可以用来查看自己有哪些MR未合并。注意：只显示自己创建的。")]),t._v(" "),a("ul",[a("li",[t._v("如果可以合并，显示 [ok]")]),t._v(" "),a("li",[t._v("如果有冲突，显示 [conflict]")])]),t._v(" "),a("p",[a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154126283.png",alt:"85ac4ee87e49965270f502ef830bf619.png"}})]),t._v(" "),a("h3",{attrs:{id:"合并mr"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#合并mr"}},[t._v("#")]),t._v(" 合并MR")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 格式如下")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# mr.exe merge {mr_url}")]),t._v("\nmr.exe merge https://gitlab.com/my-project/-/merge_requests/2\n")])])]),a("p",[t._v("{mr_url} 的值可以根据以下方式来获取：")]),t._v(" "),a("ol",[a("li",[t._v("create 命令成功后的输出")]),t._v(" "),a("li",[t._v("list 命令的输出")]),t._v(" "),a("li",[t._v("gitlab web界面上 MR 的 url")])]),t._v(" "),a("p",[t._v("合并前会有确认提示：\n"),a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154129605.png",alt:"image.png"}})]),t._v(" "),a("p",[t._v("可以取消，防止误合并：\n"),a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154133045.png",alt:"image.png"}})]),t._v(" "),a("h3",{attrs:{id:"冲突处理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#冲突处理"}},[t._v("#")]),t._v(" 冲突处理")]),t._v(" "),a("p",[t._v("解决冲突，切换分支，是很麻烦的事情，故本工具为解决冲突提供了一些辅助功能。")]),t._v(" "),a("p",[t._v("注意：命令行只做拉取代码、切合分支等必要操作，冲突的解决仍需要人工介入，工具不会自动合并代码的。")]),t._v(" "),a("p",[t._v("合并冲突状态的MR：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("mr.exe merge "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("conflict_mr_url"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("出现提示，是否自动切换分支为解决冲突作准备：\n"),a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154136190.png",alt:"image.png"}}),t._v("\n当然在此之前，要保证工作目录是干净的，如果有修改未提交，会中止切换分支操作：\n"),a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154139322.png",alt:"image.png"}})]),t._v(" "),a("blockquote",[a("p",[t._v("可以使用 "),a("code",[t._v("git stash")]),t._v("保存修改，合并冲突后，再 "),a("code",[t._v("git stash pop")])])]),t._v(" "),a("p",[t._v("命令执行成功时，会切换到 "),a("code",[t._v("conflict/")]),t._v(" 开头的分支。\n此时，打开 IDE 或 Git 管理工具，根据提示把相应的分支合并到 "),a("code",[t._v("conflict/")]),t._v(" 分支即可。\n"),a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154143622.png",alt:"image.png"}})]),t._v(" "),a("p",[t._v("以 IDEA 为例：\n"),a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154146323.png",alt:"image.png"}})]),t._v(" "),a("p",[t._v("解决冲突后，再切回命令行，此时有两种选择：")]),t._v(" "),a("ol",[a("li",[t._v("创建 MR，适用于自己没有权限合并的场景")]),t._v(" "),a("li",[t._v("合并 MR，适用于自己有权限合并的场景")])]),t._v(" "),a("p",[t._v("如果是创建，再次执行 create 命令即可：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("mr create\n")])])]),a("p",[a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154149211.png",alt:"image.png"}}),t._v("\n创建的 MR 合并时会自动删除 "),a("code",[t._v("conflict/")]),t._v(" 分支。\n"),a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154152000.png",alt:"image.png"}})]),t._v(" "),a("p",[t._v("如果是合并，同样再次执行 merge 命令即可，此时不用带参数：")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("mr merge\n")])])]),a("p",[a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154155089.png",alt:"image.png"}}),t._v(" "),a("img",{attrs:{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/tools/1689154158111.png",alt:"52fee749bc6d270f9ccab3eb0e04208b.png"}})])])}),[],!1,null,null,null);a.default=e.exports}}]);
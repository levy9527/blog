import{_ as c}from"./plugin-vue_export-helper-c27b6911.js";import{r as l,o,c as r,e as u,a as n,b as a,d as s,w as p,f as t}from"./app-ab8c151e.js";const d={},m=n("h1",{id:"gitlab-ci",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#gitlab-ci","aria-hidden":"true"},"#"),a(" GitLab CI")],-1),k=n("h2",{id:"å‰è¨€",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#å‰è¨€","aria-hidden":"true"},"#"),a(" å‰è¨€")],-1),g=n("p",null,"GitLab åœ¨ä¼ä¸šå†…éƒ¨è¿˜æ˜¯æ¯”è¾ƒé€šç”¨çš„ï¼Œå…¶ CI ç”¨èµ·æ¥ä¸ªäººä¹Ÿè§‰å¾—æ¯” Jenkins é¡ºæ‰‹ï¼Œå› æ­¤åœ¨è¿™é‡Œåˆ†äº«ä¸€ä¸‹ç›¸å…³çš„å®è·µç»éªŒã€‚",-1),v=t(`<h2 id="å®‰è£…ä¸é…ç½®" tabindex="-1"><a class="header-anchor" href="#å®‰è£…ä¸é…ç½®" aria-hidden="true">#</a> å®‰è£…ä¸é…ç½®</h2><h3 id="gitlab-runner-å®‰è£…" tabindex="-1"><a class="header-anchor" href="#gitlab-runner-å®‰è£…" aria-hidden="true">#</a> GitLab Runner å®‰è£…</h3><p>è¿›è¡Œ Gitlab CI çš„ç¬¬ä¸€æ­¥æ˜¯è¦å®‰è£… GitLab Runnerã€‚å¦‚æœå…¬å¸ã€å›¢é˜Ÿå†…éƒ¨å·²å®‰è£…è¿‡ï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ã€‚</p><p>è¿™é‡Œæ¨èä½¿ç”¨ docker çš„æ–¹å¼å®‰è£…ï¼Œå¤åˆ¶ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œå³å¯ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">--name</span> gitlab-runner <span class="token parameter variable">--restart</span> always <span class="token punctuation">\\</span>
  <span class="token parameter variable">-v</span> /var/run/docker.sock:/var/run/docker.sock <span class="token punctuation">\\</span>
  <span class="token parameter variable">-v</span> /srv/gitlab-runner/config:/etc/gitlab-runner <span class="token punctuation">\\</span>
  gitlab/gitlab-runner:latest
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,5),b={href:"https://docs.gitlab.com/runner/install/docker.html#install-the-docker-image-and-start-the-container",target:"_blank",rel:"noopener noreferrer"},h=n("h3",{id:"gitlab-runner-æ³¨å†Œ",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#gitlab-runner-æ³¨å†Œ","aria-hidden":"true"},"#"),a(" GitLab Runner æ³¨å†Œ")],-1),y=n("p",null,"GitLab Runner å®‰è£…ä»¥åï¼Œè¿˜è¦æ³¨å†Œåˆ° GitLab çš„é¡¹ç›®ä¸­æ‰èƒ½ä½¿ç”¨ï¼Œæ­¤æ­¥éª¤éœ€è¦é¡¹ç›®çš„ Maintainer æƒé™ã€‚",-1),f=n("p",null,[a("åœ¨æ³¨å†Œå‰ï¼Œå¯ä»¥å…ˆæ£€æŸ¥ä¸‹ï¼Œè‡ªå·±çš„é¡¹ç›®ä¸­æ˜¯å¦å·²æœ‰å¯ä»¥ä½¿ç”¨çš„ GitLab Runnerï¼ˆå¦‚æœçœ‹ä¸åˆ° Settingsï¼Œè¯´æ˜æ²¡æœ‰æƒé™ï¼‰ï¼Œå¦‚æœæœ‰å°±è®°ä½å…¶åå­—ï¼Œç„¶åè·³è¿‡æ­¤æ­¥éª¤ã€‚"),n("br"),n("img",{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/software-test/1683277808112.png",alt:"",loading:"lazy"})],-1),_={href:"https://docs.gitlab.com/ee/ci/runners/runners_scope.html",target:"_blank",rel:"noopener noreferrer"},x=n("br",null,null,-1),E=n("img",{src:"https://raw.gitmirror.com/levy9527/image-holder/main/docs/git/1682387098778.png",alt:"image.png",loading:"lazy"},null,-1),j=t(`<p>ä¸‹é¢ä»¥ Specific Runner ä¸ºä¾‹è¿›è¡Œè¯´æ˜ã€‚</p><p>è¿›å…¥é¡¹ç›®å¦‚ä¸‹ç•Œé¢ï¼š<br><img src="https://raw.gitmirror.com/levy9527/image-holder/main/docs/git/1682387102770.png" alt="image.png" loading="lazy"></p><p>æ‹¿åˆ° URL åŠ tokenï¼š<br><img src="https://raw.gitmirror.com/levy9527/image-holder/main/docs/git/1682387107092.png" alt="image.png" loading="lazy"></p><p>æ‰§è¡Œå‘½ä»¤è¿›è¡Œæ³¨å†Œ:</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> run <span class="token parameter variable">--rm</span> <span class="token parameter variable">-it</span> <span class="token parameter variable">-v</span> /srv/gitlab-runner/config:/etc/gitlab-runner gitlab/gitlab-runner register
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>æ ¹æ®æç¤ºè¾“å…¥å†…å®¹ï¼Œå…¶ä¸­ URL åŠ token å°±æ˜¯å‰é¢æ­¥éª¤ä¸­ Web ç•Œé¢è·å–çš„ä¿¡æ¯ã€‚</p><p>å‘½ä»¤è¡Œæ“ä½œç¤ºä¾‹å¦‚ä¸‹ï¼Œæ³¨æ„ä¸¤ç‚¹å³å¯ï¼š</p><ol><li>æœ€é‡è¦çš„å°±æ˜¯ URL ä¸ tokenï¼Œéœ€è¦æ ¹æ®å®é™…æƒ…å†µå¡«å†™</li><li>å…¶ä»–å‚æ•°å¯ä»¥ä¸ç¤ºä¾‹å®Œå…¨ä¸€è‡´</li></ol><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>Enter the GitLab instance URL <span class="token punctuation">(</span>for example, https://gitlab.com/<span class="token punctuation">)</span>:
https://your-gitlab

Enter the registration token:
your-token

Enter a description <span class="token keyword">for</span> the runner:
<span class="token function">java</span>

Enter tags <span class="token keyword">for</span> the runner <span class="token punctuation">(</span>comma-separated<span class="token punctuation">)</span>:
<span class="token function">java</span>


Enter an executor: custom, shell, virtualbox, kubernetes, docker, docker-ssh, parallels, ssh, docker+machine, docker-ssh+machine:
<span class="token function">docker</span>

Enter the default Docker image <span class="token punctuation">(</span>for example, ruby:2.6<span class="token punctuation">)</span>:
maven:3.6.3-openjdk-8
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨å†ŒæˆåŠŸåï¼Œæ˜¾ç¤ºç¤ºä¾‹å¦‚ä¸‹ï¼š<br><img src="https://raw.gitmirror.com/levy9527/image-holder/main/docs/git/1682387118062.png" alt="image.png" loading="lazy"></p><h3 id="æäº¤-gitlab-ci-yml" tabindex="-1"><a class="header-anchor" href="#æäº¤-gitlab-ci-yml" aria-hidden="true">#</a> æäº¤.gitlab-ci.yml</h3><p>è¦æƒ³ Gitlab Runner å·¥ä½œï¼Œè¿˜éœ€è¦åœ¨é¡¹ç›®æ ¹ç›®å½•æäº¤ .gitlab-ci.yml æ–‡ä»¶ã€‚</p><p>å»ºè®®æäº¤.gitlab-ci.ymlæ–‡ä»¶å‰ï¼Œåœ¨ GitLab å…ˆè¿›è¡Œè¯­æ³•æ ¡éªŒã€‚<br><img src="https://raw.gitmirror.com/levy9527/image-holder/main/docs/git/1682388474604.png" alt="image.png" loading="lazy"></p><p>å¦‚æœé”™è¯¯ï¼Œä¼šæœ‰æç¤ºã€‚<br><img src="https://raw.gitmirror.com/levy9527/image-holder/main/docs/git/1682388478169.png" alt="image.png" loading="lazy"></p><p>å¦‚æœé…ç½®æˆåŠŸï¼Œä¼šçœ‹åˆ° GitLab çš„å›¾æ ‡ï¼š<br><img src="https://raw.githubusercontent.com/levy9527/image-holder/main/md-image-kit/1695784435960-bdac2473-54cd-4c42-85f3-cfbf18e21274.png" alt="" loading="lazy"></p><p>å¦‚æœå›¾æ ‡å¦‚ä¸‹æ‰€ç¤ºï¼Œè¯´æ˜æ–‡ä»¶æœ‰è¯¯ï¼Œæ¯”å¦‚æ–‡ä»¶åå¼€å¤´å¤šäº†ä¸ªç©ºæ ¼ğŸ¤¦â€â™‚ï¸ï¼š<br><img src="https://raw.githubusercontent.com/levy9527/image-holder/main/md-image-kit/1695784470379-51a5693b-ecfc-4b7f-9b67-5b0b00ccf8d0.png" alt="" loading="lazy"></p><p>ä»¥ä¸Šå°±æ˜¯ GitLab CI æ‰€éœ€çš„åŸºæœ¬ç¯å¢ƒé…ç½®ï¼Œæ¥ä¸‹æ¥è¿›è¡Œå®æˆ˜å†…å®¹è®²è§£ã€‚</p><h2 id="åˆå¹¶ä»£ç å‰è¿›è¡Œæ£€æŸ¥" tabindex="-1"><a class="header-anchor" href="#åˆå¹¶ä»£ç å‰è¿›è¡Œæ£€æŸ¥" aria-hidden="true">#</a> åˆå¹¶ä»£ç å‰è¿›è¡Œæ£€æŸ¥</h2><h3 id="èƒŒæ™¯" tabindex="-1"><a class="header-anchor" href="#èƒŒæ™¯" aria-hidden="true">#</a> èƒŒæ™¯</h3><p>æœ‰çš„äº§å“çº¿ä½¿ç”¨ Jenkins è¿›è¡Œ CIï¼Œä½†åˆæ²¡è®¾ç½®å¥½ç›¸åº”çš„ GitLab æ’ä»¶ï¼Œäºæ˜¯ä¼šå½¢æˆè¿™æ ·ä¸€ä¸ªæµç¨‹ï¼š</p><ul><li>feature åˆ†æ”¯å‘èµ· Merge Request</li><li>åˆå¹¶è‡³å—ä¿æŠ¤çš„åˆ†æ”¯</li><li>ç™»å½• Jenkinsï¼Œç‚¹å‡»æ„å»º</li><li>æ„å»ºå¤±è´¥ï¼ŒåŸå› ï¼šç¼–è¯‘æŠ¥é”™</li></ul><p>æœ€åä¸€ç‚¹ï¼Œéå¸¸éš¾ä»¥å¿å—ï¼Œå› ä¸ºä»£ç å·²ç»åˆå¹¶è¿›å»äº†ï¼Œæœ¨å·²æˆèˆŸã€‚æ­¤æ—¶é¢å¯¹ç¼–è¯‘æŠ¥é”™ï¼Œç¬¬ä¸€ååº”æ˜¯è§£å†³æŠ¥é”™ï¼Œé‡æ–°ç¼–è¯‘ã€‚ä½†æœ‰æ²¡æœ‰ä¸€ç§å¯èƒ½ï¼Œæˆ‘æ ¹æœ¬ä¸æƒ³è¦è¿™äº›ç¼–è¯‘æŠ¥é”™çš„ä»£ç å‘¢ï¼Ÿ</p><p>ç¬”è€…è¿˜æ˜¯æ›´å€¾å‘äºé˜²æ‚£äºæœªç„¶çš„æ€ç»´æ¨¡å¼ï¼Œä¹Ÿå³ä¸èƒ½é€šè¿‡ç¼–è¯‘çš„ä»£ç ï¼Œä¸å…è®¸åˆå¹¶è‡³å—ä¿æŠ¤çš„åˆ†æ”¯ã€‚è€Œä½¿ç”¨ Gitlab CI æ¥åšè¿™ä»¶äº‹æ¯” Jenkins ä½“éªŒæ›´ä¸æ»‘ï¼Œä¸‹é¢å°±æ¥ä»‹ç»ä¸€ä¸‹å…·ä½“çš„åšæ³•ã€‚</p><h3 id="è®¾ç½®mræ£€æŸ¥" tabindex="-1"><a class="header-anchor" href="#è®¾ç½®mræ£€æŸ¥" aria-hidden="true">#</a> è®¾ç½®MRæ£€æŸ¥</h3><p>è¿›å…¥é¡¹ç›®å¦‚ä¸‹ç•Œé¢ï¼š<br><img src="https://raw.gitmirror.com/levy9527/image-holder/main/docs/git/1682387122013.png" alt="image.png" loading="lazy"></p><p>å‹¾é€‰æµæ°´çº¿å¿…é¡»æˆåŠŸã€‚<br><img src="https://raw.gitmirror.com/levy9527/image-holder/main/docs/git/1682388470210.png" alt="image.png" loading="lazy"></p><h3 id="gitlab-ci-yml-ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#gitlab-ci-yml-ç¤ºä¾‹" aria-hidden="true">#</a> .gitlab-ci.yml ç¤ºä¾‹</h3><p>ç®€å•ç¤ºä¾‹å¦‚ä¸‹ï¼Œæ ¹æ®å®é™…æƒ…å†µä¿®æ”¹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">image</span><span class="token punctuation">:</span> maven<span class="token punctuation">:</span>3.6.3<span class="token punctuation">-</span>openjdk<span class="token punctuation">-</span><span class="token number">8</span>

<span class="token key atrule">variables</span><span class="token punctuation">:</span>
  <span class="token key atrule">MAVEN_CLI_OPTS</span><span class="token punctuation">:</span> <span class="token string">&quot;-s .m2/settings.xml --batch-mode&quot;</span>
  <span class="token key atrule">MAVEN_OPTS</span><span class="token punctuation">:</span> <span class="token string">&quot;-Dmaven.repo.local=.m2/repository&quot;</span>

<span class="token key atrule">cache</span><span class="token punctuation">:</span>
  <span class="token key atrule">paths</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> .m2/repository

<span class="token key atrule">stages</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> build

<span class="token key atrule">build</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> mvn $MAVEN_CLI_OPTS clean compile
  <span class="token key atrule">tags</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> java <span class="token comment"># è¿™æ˜¯æ³¨å†Œäº†çš„ gitlab runner çš„ tag</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_MERGE_REQUEST_TARGET_BRANCH_NAME =~ /develop<span class="token punctuation">|</span>test<span class="token punctuation">|</span>uat/

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸Šè¿°ç¤ºä¾‹è¦è®¾ç½®æˆåŠŸï¼Œè¿˜è¦ç¡®ä¿ .m2/settings.xml æ–‡ä»¶å­˜åœ¨ã€‚</p><h3 id="æ•ˆæœ" tabindex="-1"><a class="header-anchor" href="#æ•ˆæœ" aria-hidden="true">#</a> æ•ˆæœ</h3><p>å½“æµæ°´çº¿è¿˜æœªç»“æŸæ—¶ï¼Œä¸èƒ½æå‰åˆå¹¶ä»£ç ï¼Œåªèƒ½ç­‰å¾…æµæ°´çº¿æˆåŠŸã€‚<br><img src="https://raw.gitmirror.com/levy9527/image-holder/main/docs/git/1682388481821.png" alt="image.png" loading="lazy"></p><p>å¦‚æœæµæ°´çº¿å¤±è´¥äº†ï¼Œä¸èƒ½åˆå¹¶ã€‚<br><img src="https://raw.gitmirror.com/levy9527/image-holder/main/docs/git/1682388485568.png" alt="image.png" loading="lazy"></p><h2 id="é›†æˆå•å…ƒæµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#é›†æˆå•å…ƒæµ‹è¯•" aria-hidden="true">#</a> é›†æˆå•å…ƒæµ‹è¯•</h2><p>æ ¸å¿ƒæ€è·¯å°±æ˜¯åœ¨ CI ç¯å¢ƒè¿è¡Œ <code>mvn test</code>ã€‚</p><p>å¯èƒ½é‡åˆ°çš„é—®é¢˜åœ¨äºï¼Œç”±äºé¡¹ç›®ä¾èµ–å…³ç³»ï¼š</p><ol><li>æ—§ä»£ç ä¸­è¿è¡Œä¸é€šè¿‡çš„æµ‹è¯•å½±å“åˆ°äº† <code>mvn test</code> çš„ç»“æœ</li><li>pom.xml æ— æ³•è¯»å–ç›¸å…³çš„é…ç½®</li></ol><p>é¦–å…ˆï¼Œå‡è®¾æ ¹ç›®å½•ä¸º parentï¼Œå…¶ä¸‹æœ‰ä¸‰ä¸ªå­æ¨¡å—ï¼š</p><ul><li>a</li><li>b</li><li>common</li></ul><p>æ¯ä¸ªç›®å½•éƒ½æœ‰ pom.xmlï¼Œå…¶ä¸­æ‰€æœ‰å­æ¨¡å—çš„å±æ€§å€¼éƒ½æ¥è‡ªäº parent ç›®å½•çš„ pom.xmlã€‚</p><p>è€Œæˆ‘ä»¬éœ€è¦è¿›è¡ŒæŒç»­é›†æˆçš„æ¨¡å—æ˜¯ bï¼Œåˆ™ maven å‘½ä»¤åº”è¯¥å¦‚ä¸‹ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mvn --also-make <span class="token parameter variable">-pl</span> b <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åˆ™æ­¤æ—¶å°±è·³è¿‡äº†å­æ¨¡å— aã€‚</p><p>ä½†å¦‚æœå­æ¨¡å— b åˆä¾èµ–äº† commonï¼Œæ­¤æ—¶ common çš„é—ç•™çš„æµ‹è¯•ç”¨ä¾‹æŠ¥é”™äº†ï¼Œé‚£æˆ‘ä»¬çš„è§£å†³åŠæ³•åªèƒ½æ˜¯ï¼šä¸€ä¸ªä¸ªåœ°è§£å†³æŠ¥é”™ã€‚</p><p>å½“ä¸Šè¿° maven å‘½ä»¤å¯ä»¥è¿è¡Œåï¼Œå°±å¯ä»¥ä¿®æ”¹ Gitlab CI çš„é…ç½®ï¼Œç„¶åè®¾ç½®è°ƒåº¦ä»»åŠ¡ï¼Œè®© Gitlab æ¯å¤©éƒ½è·‘æµ‹è¯•ç”¨ä¾‹ã€‚ä¸€æ—¦ç”¨ä¾‹æ‰§è¡Œä¸é€šè¿‡ï¼Œå°±ä¼šå‘é‚®ä»¶é€šçŸ¥åˆ°æˆ‘ä»¬ã€‚</p><figure><img src="https://raw.gitmirror.com/levy9527/image-holder/main/docs/software-test/1683436020492.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h2 id="çº¿ä¸Šå‘å¸ƒ-jar" tabindex="-1"><a class="header-anchor" href="#çº¿ä¸Šå‘å¸ƒ-jar" aria-hidden="true">#</a> çº¿ä¸Šå‘å¸ƒ jar</h2><p>å¯ä»¥åœ¨å‰æ–‡çš„åŸºç¡€ä¸Šï¼Œè®¾ç½®æµæ°´çº¿è‡ªåŠ¨å‘å¸ƒ jarã€‚</p><h3 id="mavené…ç½®" tabindex="-1"><a class="header-anchor" href="#mavené…ç½®" aria-hidden="true">#</a> Mavené…ç½®</h3><p>è€ƒè™‘åˆ°ä¸€ä¸ªé¡¹ç›®Aï¼Œå¯èƒ½åˆ’åˆ†äº†å¤šä¸ªæ¨¡å—ï¼Œå¹¶éæ¯ä¸ªæ¨¡å—éƒ½éœ€è¦å‘å¸ƒ jarï¼Œå¯ä»¥ä¿®æ”¹å¯¹åº”æ¨¡å—çš„ pom.xml</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--  è·³è¿‡ deploy æ­¥éª¤   --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-deploy-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>skip</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>skip</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ™åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ deploy å‘½ä»¤å³å¯ï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mvn deploy <span class="token parameter variable">-Dmaven.test.skip</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="gitlab-ci-yml-é…ç½®" tabindex="-1"><a class="header-anchor" href="#gitlab-ci-yml-é…ç½®" aria-hidden="true">#</a> .gitlab-ci.yml é…ç½®</h3><p>ç›¸åº”çš„é…ç½®å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">deploy</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> deploy
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> mvn $MAVEN_CLI_OPTS <span class="token punctuation">-</span>Dmaven.test.skip deploy
  <span class="token key atrule">tags</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> java
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">if</span><span class="token punctuation">:</span> $CI_COMMIT_BRANCH =~ /develop<span class="token punctuation">|</span>test<span class="token punctuation">|</span>uat/

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä»£ç åˆå¹¶æˆ–æœ‰æ–°çš„ commit æ—¶ï¼Œä¼šæ‰§è¡Œæµæ°´çº¿ï¼š<br><img src="https://raw.gitmirror.com/levy9527/image-holder/main/docs/git/1682388489368.png" alt="image.png" loading="lazy"></p><h3 id="æ‹‰å–æœ€æ–°çš„jar" tabindex="-1"><a class="header-anchor" href="#æ‹‰å–æœ€æ–°çš„jar" aria-hidden="true">#</a> æ‹‰å–æœ€æ–°çš„jar</h3><p>åœ¨Bé¡¹ç›®ä¸­ï¼Œå¦‚æœè¦å¼•ç”¨Aé¡¹ç›®æ‰“å‡ºæ¥çš„ jarï¼Œè®°å¾—æ‹‰å–æœ€æ–°çš„ç‰ˆæœ¬ï¼Œpom.xml è®¾ç½®å¦‚ä¸‹ï¼š</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>nexus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>nexus-snapshot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://localhost:8081/repository/maven-snapshots/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--     æ‹‰å–æœ€æ–°çš„   --&gt;</span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>updatePolicy</span><span class="token punctuation">&gt;</span></span>always<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>updatePolicy</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä¿å­˜ä¸­é—´äº§ç‰©" tabindex="-1"><a class="header-anchor" href="#ä¿å­˜ä¸­é—´äº§ç‰©" aria-hidden="true">#</a> ä¿å­˜ä¸­é—´äº§ç‰©</h2><p>éœ€è¦ä¿å­˜ä¸­é—´äº§ç‰©çš„ä¸€ä¸ªåœºæ™¯æ˜¯ï¼Œæµæ°´çº¿åˆ†å¤šä¸ªé˜¶æ®µï¼Œåä¸€ä¸ªé˜¶æ®µä¾èµ–å‰ä¸€ä¸ªé˜¶æ®µçš„äº§ç‰©ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼šæŸä¸ª java é¡¹ç›®ï¼Œéœ€è¦å…ˆç¼–è¯‘è¾“å‡º jarï¼Œå†åŸºäº jar æ„å»ºé•œåƒã€‚</p><p>ç›¸å…³ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">build-jar</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> build
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> mvn clean package <span class="token punctuation">-</span>P $<span class="token punctuation">{</span>CI_COMMIT_REF_NAME<span class="token punctuation">}</span> <span class="token punctuation">-</span>U <span class="token punctuation">-</span>DskipTests
  <span class="token key atrule">artifacts</span><span class="token punctuation">:</span> <span class="token comment"># save output </span>
    <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> $<span class="token punctuation">{</span>APP_NAME<span class="token punctuation">}</span>/target/$<span class="token punctuation">{</span>APP_NAME<span class="token punctuation">}</span><span class="token important">*.jar</span>
  <span class="token key atrule">tags</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> java
  <span class="token key atrule">only</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> /test<span class="token punctuation">|</span>uat/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">build-image</span><span class="token punctuation">:</span>
  <span class="token key atrule">stage</span><span class="token punctuation">:</span> push
  <span class="token key atrule">script</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> docker build <span class="token punctuation">-</span>f $<span class="token punctuation">{</span>APP_NAME<span class="token punctuation">}</span>/Dockerfile <span class="token punctuation">-</span>t $<span class="token punctuation">{</span>IMAGE_NAME<span class="token punctuation">}</span> .
    <span class="token punctuation">-</span> docker push $<span class="token punctuation">{</span>IMAGE_NAME<span class="token punctuation">}</span>
    <span class="token punctuation">-</span> docker rmi $<span class="token punctuation">{</span>IMAGE_NAME<span class="token punctuation">}</span>
  <span class="token key atrule">dependencies</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> build<span class="token punctuation">-</span>jar
  <span class="token key atrule">tags</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> java
  <span class="token key atrule">only</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> /test<span class="token punctuation">|</span>uat/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å…¶ä»–é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#å…¶ä»–é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ" aria-hidden="true">#</a> å…¶ä»–é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ</h2><h3 id="node-js" tabindex="-1"><a class="header-anchor" href="#node-js" aria-hidden="true">#</a> Node.js</h3><p>æœ¬æ–‡ä¸»è¦ä»¥ Java é¡¹ç›®ä¸ºä¾‹è¿›è¡Œ Gitlab CI ç›¸å…³çš„è®²è§£ï¼Œå¦‚æœéœ€è¦ Node.js é¡¹ç›®çš„ç¤ºä¾‹ï¼Œå¯ä»¥æŸ¥çœ‹å¦å¤–ä¸¤ç¯‡æ–‡ç« ï¼š</p>`,69),w=t(`<h3 id="åˆ›å»ºä¸äº†å®¹å™¨" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸äº†å®¹å™¨" aria-hidden="true">#</a> åˆ›å»ºä¸äº†å®¹å™¨</h3><blockquote><p>ERROR: Preparation failed: adding cache volume: set volume permissions: running permission container &quot;d1574748b77fc73a4319a45341af1f0eab983900d81885a02c017ff6c5559f28&quot; for volume &quot;runner-bzsttzs-project-2271-concurrent-0-cache-3c3f060a0374fc8bc39395164f415a70&quot;: starting permission container: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused &quot;process_linux.go:319: getting the final child&#39;s pid from pipe caused &quot;EOF&quot;&quot;: unknown (linux_set.go:105:0s)</p></blockquote><p>å¯ä»¥å°è¯•çš„æ–¹æ¡ˆï¼š</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">docker</span> restart gitlab-runner
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦‚æœä¸Šè¿°æ–¹æ³•ä¸è¡Œï¼Œå¯å°è¯•é‡å¯ docker</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> systemctl stop <span class="token function">docker</span>
<span class="token function">sudo</span> systemctl start <span class="token function">docker</span>
<span class="token function">sudo</span> systemctl status <span class="token function">docker</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æœ¬åœ°æˆåŠŸ-æµæ°´çº¿å¤±è´¥" tabindex="-1"><a class="header-anchor" href="#æœ¬åœ°æˆåŠŸ-æµæ°´çº¿å¤±è´¥" aria-hidden="true">#</a> æœ¬åœ°æˆåŠŸï¼Œæµæ°´çº¿å¤±è´¥</h3><p>å¦‚æœæµæ°´çº¿ç¼–è¯‘æŠ¥é”™ï¼Œæœ¬åœ°ç¼–è¯‘é€šè¿‡ï¼Œä¸ç”¨æ€€ç–‘ï¼Œä¸€å®šæ˜¯æœ¬åœ°çš„é—®é¢˜ã€‚</p><p>æœ¬åœ°ä¹‹æ‰€ä»¥èƒ½ç¼–è¯‘é€šè¿‡ï¼Œæ˜¯å› ä¸ºæœ‰ç¼“å­˜ã€‚å¦‚æœ pom.xml æ²¡æœ‰è®¾ç½® <code>&lt;updatePolicy&gt;always&lt;/updatePolicy&gt;</code>ï¼Œç¼–è¯‘æ—¶å¾ˆå¯èƒ½ä½¿ç”¨çš„æ˜¯ç¼“å­˜ã€‚</p><p>æ¸…é™¤ç¼“å­˜æ‹‰å–æœ€æ–°çš„åŒ…å³å¯ã€‚</p><div class="language-python line-numbers-mode" data-ext="py"><pre class="language-python"><code>mvn <span class="token operator">-</span>U clean install
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="å‚è€ƒæ–‡æ¡£" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒæ–‡æ¡£" aria-hidden="true">#</a> å‚è€ƒæ–‡æ¡£</h2>`,12),I={href:"https://docs.gitlab.com/ee/ci/examples/",target:"_blank",rel:"noopener noreferrer"},A={href:"https://docs.gitlab.com/ee/ci/variables/predefined_variables.html",target:"_blank",rel:"noopener noreferrer"},C={href:"https://docs.gitlab.com/ee/ci/jobs/job_control.html#specify-when-jobs-run-with-rules",target:"_blank",rel:"noopener noreferrer"};function G(L,R){const e=l("ExternalLinkIcon"),i=l("RouterLink");return o(),r("div",null,[m,k,g,u(" more "),v,n("p",null,[a("å…¶ä»–å®‰è£…æ–¹å¼å¯æŸ¥é˜…"),n("a",b,[a("æ–‡æ¡£"),s(e)]),a("ã€‚")]),h,y,f,n("p",null,[a("GitLab Runner æ ¹æ®èŒƒå›´åˆ†ä¸º"),n("a",_,[a("ä¸‰ç§"),s(e)]),a("ã€‚"),x,E]),j,n("ul",null,[n("li",null,[s(i,{to:"/software-testing/use-playwright-for-ui-testing.html#%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90"},{default:p(()=>[a("Playwright UIè‡ªåŠ¨åŒ–æµ‹è¯•")]),_:1})]),n("li",null,[s(i,{to:"/software-testing/use-postman-for-api-testing.html#%E5%BB%BA%E7%AB%8Bci%E4%BB%BB%E5%8A%A1"},{default:p(()=>[a("Postman APIè‡ªåŠ¨åŒ–æµ‹è¯•")]),_:1})])]),w,n("ul",null,[n("li",null,[n("a",I,[a("Gitlab CI ç¤ºä¾‹"),s(e)])]),n("li",null,[n("a",A,[a("é¢„è®¾çš„ç¯å¢ƒå˜é‡"),s(e)])]),n("li",null,[n("a",C,[a("rulesè§„åˆ™è¯´æ˜"),s(e)])])])])}const P=c(d,[["render",G],["__file","gitlab-ci.html.vue"]]);export{P as default};

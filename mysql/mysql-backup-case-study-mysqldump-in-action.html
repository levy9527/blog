<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.66" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://levy.vip/mysql/mysql-backup-case-study-mysqldump-in-action.html"><meta property="og:site_name" content="levy"><meta property="og:title" content="数据备份案例：mysqldump实战"><meta property="og:description" content="数据备份案例：mysqldump实战 背景 前面有讲数据迁移的案例(mysql-a -&gt; mysql-b)，其实在迁移前还少不了备份。 并且，因为不想停机迁移，因此还要新起一个数据库实例，记为 mysql-b'，复制 mysql-b 的相关数据。这样就能在 mysql-b' 里验证迁移SQL的正确性，以确保 mysql-b 能不宕机完成数据迁移。 在这种情况下，就需要用到我们今天的主角，数据备份工具 mysqldump。"><meta property="og:type" content="article"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-09-28T05:51:05.000Z"><meta property="article:author" content="levy"><meta property="article:tag" content="Daily"><meta property="article:tag" content="MySQL"><meta property="article:published_time" content="2023-08-17T00:00:00.000Z"><meta property="article:modified_time" content="2023-09-28T05:51:05.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"数据备份案例：mysqldump实战","image":[""],"datePublished":"2023-08-17T00:00:00.000Z","dateModified":"2023-09-28T05:51:05.000Z","author":[{"@type":"Person","name":"levy"}]}</script><meta name="google-site-verification" content="XSoaUnV59ACn-fVEvYre2y_5mka_7o_wEoMPBQpwo2M"><script async src="https://www.googletagmanager.com/gtag/js?id=G-6HEW6B1S6B"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config','G-6HEW6B1S6B');</script><link rel="alternate" type="application/rss+xml" href="https://levy.vip/rss.xml" title="levy RSS Feed"><title>数据备份案例：mysqldump实战 | levy</title><meta name="description" content="数据备份案例：mysqldump实战 背景 前面有讲数据迁移的案例(mysql-a -&gt; mysql-b)，其实在迁移前还少不了备份。 并且，因为不想停机迁移，因此还要新起一个数据库实例，记为 mysql-b'，复制 mysql-b 的相关数据。这样就能在 mysql-b' 里验证迁移SQL的正确性，以确保 mysql-b 能不宕机完成数据迁移。 在这种情况下，就需要用到我们今天的主角，数据备份工具 mysqldump。">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-37659c6e.css" as="style"><link rel="stylesheet" href="/assets/style-37659c6e.css">
    <link rel="modulepreload" href="/assets/app-208ea095.js"><link rel="modulepreload" href="/assets/mysql-backup-case-study-mysqldump-in-action.html-65e9b583.js"><link rel="modulepreload" href="/assets/mysql-backup-case-study-mysqldump-in-action.html-3c058729.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-c27b6911.js"><link rel="prefetch" href="/assets/index.html-7a0c18ef.js" as="script"><link rel="prefetch" href="/assets/about.html-29c2f306.js" as="script"><link rel="prefetch" href="/assets/a-vuepress2-entertaining-video.html-79e5be18.js" as="script"><link rel="prefetch" href="/assets/a-warning-from-navicat.html-7bd6a1df.js" as="script"><link rel="prefetch" href="/assets/about-arm-things-you-need-to-know.html-0d75d8af.js" as="script"><link rel="prefetch" href="/assets/beyond-utf8-do-you-know-utf8mb4-and-collation.html-59df61fc.js" as="script"><link rel="prefetch" href="/assets/claude-ai-in-action-extract-info-from-html.html-a0514f36.js" as="script"><link rel="prefetch" href="/assets/copy-code-may-not-be-guilty.html-80ad4684.js" as="script"><link rel="prefetch" href="/assets/dont-try-to-argue-with-a-sb.html-7f024ccd.js" as="script"><link rel="prefetch" href="/assets/iteration-retrospective-of-sanyuan.html-1c01ab3d.js" as="script"><link rel="prefetch" href="/assets/leverage-ai-to-boost-coding-productivity.html-205fa317.js" as="script"><link rel="prefetch" href="/assets/reflections-on-a-speech-by-cto-of-microsoft-china.html-c6271c98.js" as="script"><link rel="prefetch" href="/assets/things-I-have-to-vent-about-vue.html-bb95aa41.js" as="script"><link rel="prefetch" href="/assets/use-claude2-instead-of-chatgpt.html-cc68c099.js" as="script"><link rel="prefetch" href="/assets/vim-creator-pass-away.html-4e59b63b.js" as="script"><link rel="prefetch" href="/assets/what-is-the-difference-between-sh-and-bash.html-12b924c8.js" as="script"><link rel="prefetch" href="/assets/you-dont-need-to-add-tenant_id-to-every-table.html-4f8af20a.js" as="script"><link rel="prefetch" href="/assets/contemporary-college-english-1.html-56b6b5ce.js" as="script"><link rel="prefetch" href="/assets/contemporary-college-english-2.html-a25ab3be.js" as="script"><link rel="prefetch" href="/assets/contemporary-college-english-3.html-a095ae82.js" as="script"><link rel="prefetch" href="/assets/contemporary-college-english-4.html-1fc3036e.js" as="script"><link rel="prefetch" href="/assets/contemporary-college-english-5.html-b3d62c13.js" as="script"><link rel="prefetch" href="/assets/contemporary-college-english-6.html-fe1405ba.js" as="script"><link rel="prefetch" href="/assets/everyone-can-learn-english-1-overview.html-37fb962d.js" as="script"><link rel="prefetch" href="/assets/everyone-can-learn-english-2-pronunciation.html-b37acbd3.js" as="script"><link rel="prefetch" href="/assets/everyone-can-learn-english-3-words.html-f17907fa.js" as="script"><link rel="prefetch" href="/assets/everyone-can-learn-english-4-listening-and-speaking.html-87bc0067.js" as="script"><link rel="prefetch" href="/assets/everyone-can-learn-english-5-reading-and-writing.html-5868d537.js" as="script"><link rel="prefetch" href="/assets/how-to-self-evaluate-english-level.html-c3ab07c6.js" as="script"><link rel="prefetch" href="/assets/learning-7000-words-task-completed.html-806f5a25.js" as="script"><link rel="prefetch" href="/assets/let-chatgpt-be-your-foreign-language-teacher.html-de348e05.js" as="script"><link rel="prefetch" href="/assets/old-articles.html-ba472a48.js" as="script"><link rel="prefetch" href="/assets/performance-optimization-in-action.html-6d7c6eb5.js" as="script"><link rel="prefetch" href="/assets/git-best-pratices.html-23bb7024.js" as="script"><link rel="prefetch" href="/assets/git-definitive-guide-to-merge-code.html-ec2cf2f7.js" as="script"><link rel="prefetch" href="/assets/git-history-two-tricks-in-idea.html-a4d3d349.js" as="script"><link rel="prefetch" href="/assets/git-useful-commands.html-3d6e4ea0.js" as="script"><link rel="prefetch" href="/assets/gitlab-ci.html-f7f7f257.js" as="script"><link rel="prefetch" href="/assets/rethinking-git-flow.html-5a37fd94.js" as="script"><link rel="prefetch" href="/assets/use-command-line-tool-to-manage-gitlab-merge-request.html-5be9d370.js" as="script"><link rel="prefetch" href="/assets/common-practices-for-handling-excel.html-236dde3f.js" as="script"><link rel="prefetch" href="/assets/how-to-convert-snapshot-into-release-jar-without-source-code.html-79790a0a.js" as="script"><link rel="prefetch" href="/assets/recommend-practices-for-query-by-date-range.html-a8ad5b59.js" as="script"><link rel="prefetch" href="/assets/why-i-prefer-fastjson-instead-of-jackson.html-f39c9f91.js" as="script"><link rel="prefetch" href="/assets/why-is-it-so-hard-to-upgrade-dependencies.html-58d10d8b.js" as="script"><link rel="prefetch" href="/assets/mysql-data-migration-case-study-add-auto-increment.html-120d7e62.js" as="script"><link rel="prefetch" href="/assets/mysql-details-you-should-know-when-execute-sql-in-command-line.html-32f8101a.js" as="script"><link rel="prefetch" href="/assets/export-mysql-table-into-excel.html-dae5d66d.js" as="script"><link rel="prefetch" href="/assets/unit-testing-overview.html-a6a76eca.js" as="script"><link rel="prefetch" href="/assets/use-RestAssured-for-api-testing.html-36c07d71.js" as="script"><link rel="prefetch" href="/assets/use-cypress-for-e2e-testing.html-9a027522.js" as="script"><link rel="prefetch" href="/assets/use-jest-for-test-driven-development.html-ba257747.js" as="script"><link rel="prefetch" href="/assets/use-playwright-for-ui-testing.html-b8640bd7.js" as="script"><link rel="prefetch" href="/assets/use-postman-for-api-testing.html-8203a775.js" as="script"><link rel="prefetch" href="/assets/how-to-connect-to-internet.html-7527d6c9.js" as="script"><link rel="prefetch" href="/assets/404.html-f2d5dd87.js" as="script"><link rel="prefetch" href="/assets/index.html-6a79c9ec.js" as="script"><link rel="prefetch" href="/assets/index.html-8779bfb9.js" as="script"><link rel="prefetch" href="/assets/index.html-6039efb3.js" as="script"><link rel="prefetch" href="/assets/index.html-b483266e.js" as="script"><link rel="prefetch" href="/assets/index.html-08f7d006.js" as="script"><link rel="prefetch" href="/assets/index.html-bdb5e891.js" as="script"><link rel="prefetch" href="/assets/index.html-6866fdfe.js" as="script"><link rel="prefetch" href="/assets/index.html-b3692dcf.js" as="script"><link rel="prefetch" href="/assets/index.html-aff33757.js" as="script"><link rel="prefetch" href="/assets/index.html-fe376c9d.js" as="script"><link rel="prefetch" href="/assets/index.html-7b393b72.js" as="script"><link rel="prefetch" href="/assets/index.html-1bb998c5.js" as="script"><link rel="prefetch" href="/assets/index.html-fa3db4ea.js" as="script"><link rel="prefetch" href="/assets/index.html-c98c047d.js" as="script"><link rel="prefetch" href="/assets/index.html-e4ea5f08.js" as="script"><link rel="prefetch" href="/assets/index.html-db9a5c1a.js" as="script"><link rel="prefetch" href="/assets/index.html-8811bd65.js" as="script"><link rel="prefetch" href="/assets/index.html-5fa1740f.js" as="script"><link rel="prefetch" href="/assets/index.html-4fc033c7.js" as="script"><link rel="prefetch" href="/assets/index.html-c50be8cb.js" as="script"><link rel="prefetch" href="/assets/index.html-90b5caba.js" as="script"><link rel="prefetch" href="/assets/index.html-96e262ec.js" as="script"><link rel="prefetch" href="/assets/index.html-3d1d7f95.js" as="script"><link rel="prefetch" href="/assets/index.html-fa48630e.js" as="script"><link rel="prefetch" href="/assets/index.html-62782fea.js" as="script"><link rel="prefetch" href="/assets/index.html-dc40d5ff.js" as="script"><link rel="prefetch" href="/assets/index.html-5b2edaa1.js" as="script"><link rel="prefetch" href="/assets/index.html-15cad1de.js" as="script"><link rel="prefetch" href="/assets/index.html-c22f0db4.js" as="script"><link rel="prefetch" href="/assets/index.html-44e80ad7.js" as="script"><link rel="prefetch" href="/assets/index.html-4736b52e.js" as="script"><link rel="prefetch" href="/assets/index.html-6d3cb5cc.js" as="script"><link rel="prefetch" href="/assets/index.html-9652b718.js" as="script"><link rel="prefetch" href="/assets/about.html-4dbf4a8f.js" as="script"><link rel="prefetch" href="/assets/a-vuepress2-entertaining-video.html-da29bd13.js" as="script"><link rel="prefetch" href="/assets/a-warning-from-navicat.html-e761f615.js" as="script"><link rel="prefetch" href="/assets/about-arm-things-you-need-to-know.html-e165995f.js" as="script"><link rel="prefetch" href="/assets/beyond-utf8-do-you-know-utf8mb4-and-collation.html-b68ab922.js" as="script"><link rel="prefetch" href="/assets/claude-ai-in-action-extract-info-from-html.html-0cd01ce3.js" as="script"><link rel="prefetch" href="/assets/copy-code-may-not-be-guilty.html-504521d8.js" as="script"><link rel="prefetch" href="/assets/dont-try-to-argue-with-a-sb.html-e9d5b10e.js" as="script"><link rel="prefetch" href="/assets/iteration-retrospective-of-sanyuan.html-ef909b1d.js" as="script"><link rel="prefetch" href="/assets/leverage-ai-to-boost-coding-productivity.html-32963f0b.js" as="script"><link rel="prefetch" href="/assets/reflections-on-a-speech-by-cto-of-microsoft-china.html-ab0347d3.js" as="script"><link rel="prefetch" href="/assets/things-I-have-to-vent-about-vue.html-9ec3fee3.js" as="script"><link rel="prefetch" href="/assets/use-claude2-instead-of-chatgpt.html-92eaa07d.js" as="script"><link rel="prefetch" href="/assets/vim-creator-pass-away.html-9393c2db.js" as="script"><link rel="prefetch" href="/assets/what-is-the-difference-between-sh-and-bash.html-a1f0fcbd.js" as="script"><link rel="prefetch" href="/assets/you-dont-need-to-add-tenant_id-to-every-table.html-e1661a41.js" as="script"><link rel="prefetch" href="/assets/contemporary-college-english-1.html-348eae8f.js" as="script"><link rel="prefetch" href="/assets/contemporary-college-english-2.html-fd81a651.js" as="script"><link rel="prefetch" href="/assets/contemporary-college-english-3.html-9b228628.js" as="script"><link rel="prefetch" href="/assets/contemporary-college-english-4.html-8ba5f4ba.js" as="script"><link rel="prefetch" href="/assets/contemporary-college-english-5.html-c583c4db.js" as="script"><link rel="prefetch" href="/assets/contemporary-college-english-6.html-e848ff82.js" as="script"><link rel="prefetch" href="/assets/everyone-can-learn-english-1-overview.html-44e919e2.js" as="script"><link rel="prefetch" href="/assets/everyone-can-learn-english-2-pronunciation.html-861199d6.js" as="script"><link rel="prefetch" href="/assets/everyone-can-learn-english-3-words.html-5d2c5b0d.js" as="script"><link rel="prefetch" href="/assets/everyone-can-learn-english-4-listening-and-speaking.html-eccad8a5.js" as="script"><link rel="prefetch" href="/assets/everyone-can-learn-english-5-reading-and-writing.html-f514ac7d.js" as="script"><link rel="prefetch" href="/assets/how-to-self-evaluate-english-level.html-fa555e92.js" as="script"><link rel="prefetch" href="/assets/learning-7000-words-task-completed.html-902d43fb.js" as="script"><link rel="prefetch" href="/assets/let-chatgpt-be-your-foreign-language-teacher.html-d2bc0904.js" as="script"><link rel="prefetch" href="/assets/old-articles.html-9b2cb0e9.js" as="script"><link rel="prefetch" href="/assets/performance-optimization-in-action.html-1a68a46f.js" as="script"><link rel="prefetch" href="/assets/git-best-pratices.html-6ba72216.js" as="script"><link rel="prefetch" href="/assets/git-definitive-guide-to-merge-code.html-21ebb186.js" as="script"><link rel="prefetch" href="/assets/git-history-two-tricks-in-idea.html-e2309bab.js" as="script"><link rel="prefetch" href="/assets/git-useful-commands.html-c39bc83d.js" as="script"><link rel="prefetch" href="/assets/gitlab-ci.html-65c9056e.js" as="script"><link rel="prefetch" href="/assets/rethinking-git-flow.html-db74b219.js" as="script"><link rel="prefetch" href="/assets/use-command-line-tool-to-manage-gitlab-merge-request.html-cc121aff.js" as="script"><link rel="prefetch" href="/assets/common-practices-for-handling-excel.html-1be06edf.js" as="script"><link rel="prefetch" href="/assets/how-to-convert-snapshot-into-release-jar-without-source-code.html-60ee44b8.js" as="script"><link rel="prefetch" href="/assets/recommend-practices-for-query-by-date-range.html-3b1ce9ec.js" as="script"><link rel="prefetch" href="/assets/why-i-prefer-fastjson-instead-of-jackson.html-4ecea870.js" as="script"><link rel="prefetch" href="/assets/why-is-it-so-hard-to-upgrade-dependencies.html-c128df1c.js" as="script"><link rel="prefetch" href="/assets/mysql-data-migration-case-study-add-auto-increment.html-dd00a7cc.js" as="script"><link rel="prefetch" href="/assets/mysql-details-you-should-know-when-execute-sql-in-command-line.html-94a52ba1.js" as="script"><link rel="prefetch" href="/assets/export-mysql-table-into-excel.html-5dc80d69.js" as="script"><link rel="prefetch" href="/assets/unit-testing-overview.html-b37040e2.js" as="script"><link rel="prefetch" href="/assets/use-RestAssured-for-api-testing.html-5fc263f2.js" as="script"><link rel="prefetch" href="/assets/use-cypress-for-e2e-testing.html-e135679f.js" as="script"><link rel="prefetch" href="/assets/use-jest-for-test-driven-development.html-18c5d278.js" as="script"><link rel="prefetch" href="/assets/use-playwright-for-ui-testing.html-fc6e0b46.js" as="script"><link rel="prefetch" href="/assets/use-postman-for-api-testing.html-7265248d.js" as="script"><link rel="prefetch" href="/assets/how-to-connect-to-internet.html-edf589f0.js" as="script"><link rel="prefetch" href="/assets/404.html-96ebf227.js" as="script"><link rel="prefetch" href="/assets/index.html-7079b67e.js" as="script"><link rel="prefetch" href="/assets/index.html-e5ee3eb7.js" as="script"><link rel="prefetch" href="/assets/index.html-0db8a1fc.js" as="script"><link rel="prefetch" href="/assets/index.html-b41c02e7.js" as="script"><link rel="prefetch" href="/assets/index.html-dde26799.js" as="script"><link rel="prefetch" href="/assets/index.html-5c13838d.js" as="script"><link rel="prefetch" href="/assets/index.html-f65beed0.js" as="script"><link rel="prefetch" href="/assets/index.html-8ccddd71.js" as="script"><link rel="prefetch" href="/assets/index.html-32b34da8.js" as="script"><link rel="prefetch" href="/assets/index.html-ce93cf74.js" as="script"><link rel="prefetch" href="/assets/index.html-98d453b5.js" as="script"><link rel="prefetch" href="/assets/index.html-379b6671.js" as="script"><link rel="prefetch" href="/assets/index.html-e2ecf62e.js" as="script"><link rel="prefetch" href="/assets/index.html-55fa3eb9.js" as="script"><link rel="prefetch" href="/assets/index.html-cbf0cb91.js" as="script"><link rel="prefetch" href="/assets/index.html-640d33d0.js" as="script"><link rel="prefetch" href="/assets/index.html-d84fac49.js" as="script"><link rel="prefetch" href="/assets/index.html-97581faa.js" as="script"><link rel="prefetch" href="/assets/index.html-d54a4a8a.js" as="script"><link rel="prefetch" href="/assets/index.html-04224f4b.js" as="script"><link rel="prefetch" href="/assets/index.html-961049ca.js" as="script"><link rel="prefetch" href="/assets/index.html-c635bb73.js" as="script"><link rel="prefetch" href="/assets/index.html-08755fc0.js" as="script"><link rel="prefetch" href="/assets/index.html-b9cb42ae.js" as="script"><link rel="prefetch" href="/assets/index.html-c7de6476.js" as="script"><link rel="prefetch" href="/assets/index.html-045909f1.js" as="script"><link rel="prefetch" href="/assets/index.html-384262ce.js" as="script"><link rel="prefetch" href="/assets/index.html-139c9122.js" as="script"><link rel="prefetch" href="/assets/index.html-80e52235.js" as="script"><link rel="prefetch" href="/assets/index.html-04141376.js" as="script"><link rel="prefetch" href="/assets/index.html-4f7d86c9.js" as="script"><link rel="prefetch" href="/assets/index.html-f512e6b1.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-5794cde2.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><!--[--><a class="vp-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.png" alt="levy"><!----><span class="vp-site-name hide-in-pad">levy</span></a><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-center"><!--[--><!----><!--]--><!--[--><nav class="vp-nav-links"><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/"><span class="font-icon icon fa-fw fa-sm fas fa-house" style=""></span>首页<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button type="button" class="dropdown-title" aria-label="分类"><span class="title"><span class="font-icon icon fa-fw fa-sm fas fa-list" style=""></span>分类</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a class="vp-link nav-link" href="/tools/how-to-connect-to-internet.html"><span class="font-icon icon fa-fw fa-sm fas fa-code" style=""></span>软件研发<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/daily.html"><span class="font-icon icon fa-fw fa-sm fas fa-briefcase" style=""></span>工作日常<!----></a></li><li class="dropdown-item"><a class="vp-link nav-link" href="/english.html"><span class="font-icon icon fa-fw fa-sm fas fa-globe" style=""></span>英语学习<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a class="vp-link nav-link" href="/about.html"><span class="font-icon icon fa-fw fa-sm fas fa-circle-info" style=""></span>关于<!----></a></div></nav><!--]--><!--[--><!----><!--]--></div><div class="vp-navbar-end"><!--[--><!----><!--]--><!--[--><!----><div class="nav-item vp-repo"><a class="vp-repo-link" href="https://github.com/levy9527/blog" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><!----><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form><!--]--><!--[--><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!--[--><!----><!--]--><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><!----><span class="vp-sidebar-title">实用工具</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/tools/how-to-connect-to-internet.html"><!---->科学上网<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><!----><span class="vp-sidebar-title">Git相关</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/git/git-useful-commands.html"><!---->Git常用命令<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/git/git-definitive-guide-to-merge-code.html"><!---->Git代码合并指南<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/git/git-history-two-tricks-in-idea.html"><!---->Git查看历史记录小技巧<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/git/gitlab-ci.html"><!---->GitLab CI<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/git/rethinking-git-flow.html"><!---->再论Git Flow<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/git/git-best-pratices.html"><!---->Git最佳实践<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/git/use-command-line-tool-to-manage-gitlab-merge-request.html"><!---->操作 Gitlab MR 的命令行工具<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><!----><span class="vp-sidebar-title">软件测试</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/software-testing/unit-testing-overview.html"><!---->单元测试概述<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/software-testing/use-postman-for-api-testing.html"><!---->使用 Postman 进行 API 测试<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/software-testing/use-RestAssured-for-api-testing.html"><!---->使用 RestAssured 进行 API 测试<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/software-testing/use-jest-for-test-driven-development.html"><!---->使用 Jest 实践测试驱动开发<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/software-testing/use-playwright-for-ui-testing.html"><!---->下一代 UI 自动化测试工具 Playwright<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/software-testing/use-cypress-for-e2e-testing.html"><!---->使用 Cypress 进行端对端测试<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading active"><!----><span class="vp-sidebar-title">MySQL</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link active vp-sidebar-link vp-sidebar-page active" href="/mysql/mysql-backup-case-study-mysqldump-in-action.html"><!---->数据备份案例：mysqldump实战<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/mysql/mysql-backup-case-study-mysqldump-in-action.html#背景"><!---->背景<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/mysql/mysql-backup-case-study-mysqldump-in-action.html#架构"><!---->架构<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/mysql/mysql-backup-case-study-mysqldump-in-action.html#安装"><!---->安装<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/mysql/mysql-backup-case-study-mysqldump-in-action.html#导出"><!---->导出<!----></a><ul class="vp-sidebar-sub-headers"><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/mysql/mysql-backup-case-study-mysqldump-in-action.html#set-gtid-purged-off"><!---->--set-gtid-purged=OFF<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/mysql/mysql-backup-case-study-mysqldump-in-action.html#ignore-table"><!---->--ignore-table<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/mysql/mysql-backup-case-study-mysqldump-in-action.html#导入"><!---->导入<!----></a><ul class="vp-sidebar-sub-headers"></ul></li><li class="vp-sidebar-sub-header"><a class="vp-link nav-link vp-sidebar-link vp-heading" href="/mysql/mysql-backup-case-study-mysqldump-in-action.html#为什么不"><!---->为什么不?<!----></a><ul class="vp-sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/mysql/mysql-data-migration-case-study-add-auto-increment.html"><!---->数据迁移案例：表AUTO_INCREMENT加10w<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/mysql/mysql-details-you-should-know-when-execute-sql-in-command-line.html"><!---->MySQL 命令行执行SQL的细节<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><!----><span class="vp-sidebar-title">Java</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java/recommend-practices-for-query-by-date-range.html"><!---->根据时间范围查询推荐实践<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java/common-practices-for-handling-excel.html"><!---->Excel处理常用实践<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java/how-to-convert-snapshot-into-release-jar-without-source-code.html"><!---->奇技淫巧：在没有源码的情况下，把 snapshot 转成 release 包<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java/why-i-prefer-fastjson-instead-of-jackson.html"><!---->Jackson 经典异常 UnrecognizedPropertyException<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/java/why-is-it-so-hard-to-upgrade-dependencies.html"><!---->升个jar版本，怎么这么难？<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><!----><span class="vp-sidebar-title">Python</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/python/export-mysql-table-into-excel.html"><!---->Python 导出 MySQL 库表信息到 Excel<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-heading"><!----><span class="vp-sidebar-title">前端技术</span><!----></p><ul class="vp-sidebar-links"><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/frontend/old-articles.html"><!---->旧文章精选<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a class="vp-link nav-link vp-sidebar-link vp-sidebar-page" href="/frontend/performance-optimization-in-action.html"><!---->前端项目性能优化实战<!----></a><ul class="vp-sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->数据备份案例：mysqldump实战</h1><div class="page-info"><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-08-17T00:00:00.000Z"></span><span class="page-tag-info" aria-label="标签🏷" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item tag8 clickable" role="navigation">Daily</span><span class="page-tag-item tag3 clickable" role="navigation">MySQL</span><!--]--><meta property="keywords" content="Daily,MySQL"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><!--[--><!----><!--]--><div class="toc-header">此页内容<button type="button" class="print-button" title="打印"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#背景">背景</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#架构">架构</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#安装">安装</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#导出">导出</a></li><li><ul class="toc-list"><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#set-gtid-purged-off">--set-gtid-purged=OFF</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level3" href="/#ignore-table">--ignore-table</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#导入">导入</a></li><!----><!--]--><!--[--><li class="toc-item"><a class="vp-link toc-link level2" href="/#为什么不">为什么不?</a></li><!----><!--]--></ul><div class="toc-marker" style="top:-1.7rem;"></div></div><!--[--><!----><!--]--></aside></div><!----><div class="theme-hope-content"><h1 id="数据备份案例-mysqldump实战" tabindex="-1"><a class="header-anchor" href="#数据备份案例-mysqldump实战" aria-hidden="true">#</a> 数据备份案例：mysqldump实战</h1><h2 id="背景" tabindex="-1"><a class="header-anchor" href="#背景" aria-hidden="true">#</a> 背景</h2><p>前面有讲<a href="/mysql/mysql-data-migration-case-study-add-auto-increment.html" class="">数据迁移的案例</a>(mysql-a -&gt; mysql-b)，其实在迁移前还少不了备份。</p><p>并且，因为不想停机迁移，因此还要新起一个数据库实例，记为 mysql-b&#39;，复制 mysql-b 的相关数据。这样就能在 mysql-b&#39; 里验证迁移SQL的正确性，以确保 mysql-b 能不宕机完成数据迁移。</p><p>在这种情况下，就需要用到我们今天的主角，数据备份工具 mysqldump。</p><!-- more --><h2 id="架构" tabindex="-1"><a class="header-anchor" href="#架构" aria-hidden="true">#</a> 架构</h2><p><img src="https://raw.githubusercontent.com/levy9527/image-holder/main/md-image-kit/1692280572283-08eb507c-00b6-446b-bd37-cb5ecbe59531.jpeg" alt="" loading="lazy"><br> 注意到：</p><ol><li>从 mysql-b -&gt; mysql-b&#39;，就要用到工具 mysqldump</li><li>关于 sql 的编写在另一文中已有提及，就不重复了</li><li>只能通过跳板机在终端连接数据库实例，因此无法使用图例界面操作。</li></ol><h2 id="安装" tabindex="-1"><a class="header-anchor" href="#安装" aria-hidden="true">#</a> 安装</h2><p>首先要在跳板机安装 mysqldump。</p><p>如果够幸运，可以用包管理工具安装：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">apt</span> update

<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> mysql-client
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">sudo</span> yum <span class="token function">install</span> https://dev.mysql.com/get/mysql80-community-release-el7-3.noarch.rpm

<span class="token function">sudo</span> yum <span class="token function">install</span> mysql-community-client
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果配置有问题安装不了，可以直接下载 mysql 二进制包：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">wget</span> https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-8.0.26-linux-glibc2.12-x86_64.tar.xz

<span class="token function">tar</span> <span class="token parameter variable">-xvf</span> mysql-8.0.26-linux-glibc2.12-x86_64.tar.xz

<span class="token builtin class-name">cd</span> mysql-8.0.26-linux-glibc2.12-x86_64

<span class="token function">sudo</span> <span class="token function">cp</span> bin/mysqldump /usr/local/bin/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果还不行，那就本地下载，然后把 mysqldump 压缩通过 scp 上传到跳板机。</p><p>有人会想，这么麻烦，为何不直接复制 mysql-b 的数据文件？这是因为：</p><ol><li>没有进入 mysql-b 宿主机的权限</li><li>复制磁盘文件更麻烦，后面会讲</li></ol><h2 id="导出" tabindex="-1"><a class="header-anchor" href="#导出" aria-hidden="true">#</a> 导出</h2><p>导出命令很简单的，类似 mysql 客户端连接，指定用户名、表名、导出文件，再根据提示输入密码即可。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-h</span> <span class="token function">ip</span> <span class="token parameter variable">-P</span> port <span class="token parameter variable">-u</span> your_username <span class="token parameter variable">-p</span> your_database <span class="token operator">&gt;</span> dump.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://raw.githubusercontent.com/levy9527/image-holder/main/md-image-kit/1692281767457-f40d7db4-c2d9-4589-ac46-cbea320266da.png" alt="" loading="lazy"><br> 然而命令行的提示，暗示事情令有玄机：</p><ol><li>首先，这样简单的命令，只能导出表数据，其他数据如触发器则并没导出</li><li>其次，由于目标数据库开启了 GTID 模式(gtid_mode=ON)，导出的文件会有相关的设置</li></ol><h3 id="set-gtid-purged-off" tabindex="-1"><a class="header-anchor" href="#set-gtid-purged-off" aria-hidden="true">#</a> --set-gtid-purged=OFF</h3><p><img src="https://raw.githubusercontent.com/levy9527/image-holder/main/md-image-kit/1692281766948-704c4a90-c575-4340-b596-281c74de5c44.png" alt="" loading="lazy"><br> 打开 dump.sql 的前 30 行，可以看到 GTIDs 的相关内容。</p><p>Here&#39;s a quick overview of how GTIDs(Global Transaction Identifiers) work in MySQL：</p><ul><li>GTIDs uniquely identify every transaction.</li><li>Allow replicas to track replication positions.</li><li>Enable failover and repointing replication.</li></ul><p>因为 mysql-b 是主从架构的，开启 GTIDs 很正常，但我们要用来测试的 mysql-b&#39; 是单实例的，并不需要它。<br> 如果未正确设置，导入的时候是会报错的。</p><p>因此，在这种情况下，导出语句可以添加以下参数：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>--set-gtid-purged<span class="token operator">=</span>OFF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>也即命令变成：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysqldump <span class="token parameter variable">-h</span> <span class="token function">ip</span> <span class="token parameter variable">-P</span> port <span class="token parameter variable">-u</span> your_username <span class="token parameter variable">-p</span> --set-gtid-purged<span class="token operator">=</span>OFF your_database <span class="token operator">&gt;</span> dump.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>当然，也可以修改 dump.sql，把 GTIDs 相关的语句删除掉。</p><h3 id="ignore-table" tabindex="-1"><a class="header-anchor" href="#ignore-table" aria-hidden="true">#</a> --ignore-table</h3><p>导出的文件可能会很大，而如果我们要把文件在不同的机器之间传输，这就会让过程变得很慢。此时，我们希望导出的文件越小越好。</p><p>我们利用以下 SQL来确认下，目标库中到底是哪些表占据了较大的存储空间：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code><span class="token keyword">SELECT</span> table_name<span class="token punctuation">,</span> 
       <span class="token function">ROUND</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data_length <span class="token operator">+</span> index_length<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token keyword">AS</span> <span class="token string">&quot;Data Size (MB)&quot;</span>
<span class="token keyword">FROM</span> information_schema<span class="token punctuation">.</span><span class="token keyword">tables</span>
<span class="token keyword">WHERE</span> table_schema <span class="token operator">=</span> <span class="token string">&#39;your_database&#39;</span>
<span class="token keyword">ORDER</span> <span class="token keyword">BY</span> <span class="token punctuation">(</span>data_length <span class="token operator">+</span> index_length<span class="token punctuation">)</span> <span class="token keyword">DESC</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>接着我们根据业务，分析哪些表的数据是必要的，哪些表的数据可以不用导出。添加以下参数把不需要导出的表忽略掉：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>--ignore-table
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>示例命令：</p><div class="language-sql line-numbers-mode" data-ext="sql"><pre class="language-sql"><code>mysqldump <span class="token operator">-</span>u your_username <span class="token operator">-</span>p your_database <span class="token comment">--ignore-table=table_name1 --ignore-table=table_name2 &gt; dump.sql</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注意：该参数一次只能忽略一张表，故忽略多张表需要声明多次。</p><h2 id="导入" tabindex="-1"><a class="header-anchor" href="#导入" aria-hidden="true">#</a> 导入</h2><p>导入命令类似导出，只不过此时使用的是 mysql　客户端，并且重定向符号不同。</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>mysql <span class="token parameter variable">-u</span> your_username <span class="token parameter variable">-p</span> your_database_name <span class="token operator">&lt;</span> dump.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="为什么不" tabindex="-1"><a class="header-anchor" href="#为什么不" aria-hidden="true">#</a> 为什么不?</h2><p>现在来回答为什么不直接复制MySQL的磁盘文件。</p><p>根据前面我们知道，也许我们的需求是部分备份，而不是全量备份，则直接拷贝磁盘文件，在数据量大的情况下，只会造成传输负担，反而“欲速则不达”。</p><p>另外，复制磁盘文件，为保证数据一致性，要求MySQL必须停止运行。主要有以下原因：</p><ol><li><strong>Ative Transactions:</strong> Copying database files directly may lead to data inconsistency if there are active transactions or changes happening in the database while the files are being copied.</li><li><strong>Flush and Sync:</strong> The MySQL server may buffer data in memory and write it to disk periodically. When you copy files directly, you may capture data that is in memory and not yet written to disk.</li><li><strong>File Locks:</strong> Some storage engines, such as MyISAM, may use file-level locks, which can prevent you from copying files while the server is running. InnoDB, on the other hand, uses a different mechanism (tablespace files), but copying InnoDB files still carries the risk of data inconsistency.</li></ol><p>因此，纵然有直接复制MySQL磁盘文件的奇技淫巧，还是不建议使用，我就也不向大家展示了。</p></div><!----><footer class="page-meta"><!----><div class="meta-item git-info"><div class="update-time"><span class="label">上次编辑于: </span><!----></div><div class="contributors"><span class="label">贡献者: </span><!--[--><!--[--><span class="contributor" title="email: levy9527@gmail.com">levy</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><!----><a class="vp-link nav-link next" href="/mysql/mysql-data-migration-case-study-add-auto-increment.html"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">数据迁移案例：表AUTO_INCREMENT加10w<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><!----><div class="vp-copyright">Copyright © 2023 levy</div></footer></div><!--]--><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app-208ea095.js" defer></script>
  </body>
</html>
